<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ایڈمن پینل - مسائل ورلڈ</title>
    <meta name="description" content="مسائل ورلڈ کے لیے ایڈمن پینل - فتاویٰ، مضامین، کتابیں، اور بہت کچھ کا نظم کریں۔">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        @font-face {
            font-family: 'NaatFont';
            src: url('https://res.cloudinary.com/awescreative/raw/upload/v1749150996/Awes/naatfont.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        body {
            font-family: 'NaatFont', serif;
            font-size: 80%;
            overscroll-behavior: none;
        }
        .admin-page { display: none; }
        .admin-page.active { display: block; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #124559; border-radius: 10px;}
        ::-webkit-scrollbar-thumb:hover { background: #0b2935; }
        .sidebar-link.active {
            background-color: #01161e; /* rich_black */
            border-right: 4px solid #eff6e0; /* beige */
        }
        /* Responsive Table Styles */
        @media (max-width: 768px) {
            .responsive-table thead {
                display: none;
            }
            .responsive-table tr {
                display: block;
                margin-bottom: 1.5rem;
                border: 1px solid #dee2e6;
                border-radius: 0.5rem;
                padding: 1rem;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            }
            .responsive-table td {
                display: block;
                text-align: left;
                padding: 0.5rem 0;
                border-bottom: 1px dashed #e5e7eb;
            }
            .responsive-table td:last-child {
                border-bottom: none;
            }
            .responsive-table td::before {
                content: attr(data-label);
                float: right;
                font-weight: bold;
                margin-left: 1rem;
            }
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'rich_black': { DEFAULT: '#01161e', 100: '#000406', 200: '#00090c', 300: '#010d12', 400: '#011118', 500: '#01161e', 600: '#04597b', 700: '#079cd8', 800: '#45c6f9', 900: '#a2e3fc' },
                        'midnight_green': { DEFAULT: '#124559', 100: '#040e12', 200: '#071c24', 300: '#0b2935', 400: '#0f3747', 500: '#124559', 600: '#20799c', 700: '#36a9d6', 800: '#79c5e4', 900: '#bce2f1' },
                        'air_force_blue': { DEFAULT: '#598392', 100: '#121a1d', 200: '#24343a', 300: '#354e57', 400: '#476874', 500: '#598392', 600: '#769dab', 700: '#99b6c0', 800: '#bbced5', 900: '#dde7ea' },
                        'ash_gray': { DEFAULT: '#aec3b0', 100: '#1f2a20', 200: '#3e5441', 300: '#5e7f61', 400: '#83a386', 500: '#aec3b0', 600: '#bdcebf', 700: '#cedbcf', 800: '#dee7df', 900: '#eff3ef' },
                        'beige': { DEFAULT: '#eff6e0', 100: '#384915', 200: '#71912a', 300: '#a4cc4e', 400: '#c9e197', 500: '#eff6e0', 600: '#f2f8e6', 700: '#f5f9ec', 800: '#f8fbf2', 900: '#fcfdf9' }
                    }
                }
            }
        }
    </script>
</head>
<body class="text-rich_black bg-gray-100">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <!-- The 'translate-x-full' class hides the sidebar off-screen to the right for RTL. -->
        <!-- 'md:translate-x-0' makes it visible on medium screens and larger. -->
        <aside id="sidebar" class="w-64 bg-midnight_green text-beige flex-col shadow-2xl fixed top-0 right-0 h-full z-20 transition-transform duration-300 ease-in-out md:relative md:translate-x-0 translate-x-full">
            <div class="p-6 text-center border-b border-midnight_green-400">
                <h1 class="text-3xl font-bold">مسائل ورلڈ</h1>
                <p class="text-sm text-air_force_blue-700">ایڈمن پینل</p>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-2">
                <a href="#dashboard" class="admin-nav-link sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
                    <i class="bi bi-speedometer2 ml-3 text-2xl"></i>
                    <span>ڈیش بورڈ</span>
                </a>
                <a href="#manage-fatawa" class="admin-nav-link sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
                    <i class="bi bi-journal-check ml-3 text-2xl"></i>
                    <span>فتاویٰ</span>
                </a>
                <a href="#manage-articles" class="admin-nav-link sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
                    <i class="bi bi-pencil-square ml-3 text-2xl"></i>
                    <span>مضامین</span>
                </a>
                <a href="#manage-books" class="admin-nav-link sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
                    <i class="bi bi-book-half ml-3 text-2xl"></i>
                    <span>کتابیں</span>
                </a>
                <a href="#manage-ulema" class="admin-nav-link sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
                    <i class="bi bi-people-fill ml-3 text-2xl"></i>
                    <span>علمائے کرام</span>
                </a>
                 <a href="#manage-categories" class="admin-nav-link sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
                    <i class="bi bi-grid-fill ml-3 text-2xl"></i>
                    <span>موضوعات</span>
                </a>
                <a href="#manage-questions" class="admin-nav-link sidebar-link flex items-center px-4 py-3 text-lg rounded-md hover:bg-rich_black transition">
                    <i class="bi bi-patch-question-fill ml-3 text-2xl"></i>
                    <span>موصول سوالات</span>
                </a>
            </nav>
            <div class="p-4 border-t border-midnight_green-400">
                <div class="flex items-center p-2 rounded-md hover:bg-rich_black transition">
                    <img src="https://placehold.co/40x40/eff6e0/124559?text=A" class="w-10 h-10 rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/40x40/eff6e0/124559?text=A';">
                    <div class="mr-3">
                        <p class="font-bold text-lg">ایڈمن</p>
                        <a href="#" class="text-sm text-air_force_blue-700 hover:text-beige">لاگ آؤٹ</a>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Overlay for mobile sidebar -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-10 hidden md:hidden"></div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Top Bar for Mobile -->
            <header class="md:hidden bg-white shadow-md p-4 flex justify-between items-center">
                <h1 class="text-xl font-bold text-midnight_green">ایڈمن پینل</h1>
                <button id="sidebar-toggle" class="text-midnight_green text-2xl">
                    <i class="bi bi-list"></i>
                </button>
            </header>

            <main class="flex-1 p-4 md:p-8 overflow-y-auto">
                <div id="admin-main-content">
                    <!-- Dashboard Page -->
                    <div id="page-dashboard" class="admin-page active">
                        <h1 class="text-3xl md:text-4xl font-bold text-midnight_green mb-8">ڈیش بورڈ</h1>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 md:gap-8">
                            <!-- Stat Cards -->
                            <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg border-t-4 border-midnight_green-600">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-lg md:text-xl text-air_force_blue">کل فتاویٰ</p>
                                        <p id="total-fatawa" class="text-3xl md:text-4xl font-bold text-rich_black mt-2">0</p>
                                    </div>
                                    <div class="p-3 bg-gray-100 rounded-full">
                                        <i class="bi bi-journal-check text-2xl md:text-3xl text-midnight_green"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg border-t-4 border-air_force_blue">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-lg md:text-xl text-air_force_blue">کل مضامین</p>
                                        <p id="total-articles" class="text-3xl md:text-4xl font-bold text-rich_black mt-2">0</p>
                                    </div>
                                    <div class="p-3 bg-gray-100 rounded-full">
                                        <i class="bi bi-pencil-square text-2xl md:text-3xl text-air_force_blue"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg border-t-4 border-ash_gray">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-lg md:text-xl text-air_force_blue">کل کتابیں</p>
                                        <p id="total-books" class="text-3xl md:text-4xl font-bold text-rich_black mt-2">0</p>
                                    </div>
                                    <div class="p-3 bg-gray-100 rounded-full">
                                        <i class="bi bi-book-half text-2xl md:text-3xl text-ash_gray-500"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg border-t-4 border-midnight_green-700">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-lg md:text-xl text-air_force_blue">کل موضوعات</p>
                                        <p id="total-categories" class="text-3xl md:text-4xl font-bold text-rich_black mt-2">0</p>
                                    </div>
                                    <div class="p-3 bg-gray-100 rounded-full">
                                        <i class="bi bi-grid-fill text-2xl md:text-3xl text-midnight_green-700"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg border-t-4 border-rich_black-700">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-lg md:text-xl text-air_force_blue">نئے سوالات</p>
                                        <p id="total-questions" class="text-3xl md:text-4xl font-bold text-rich_black mt-2">0</p>
                                    </div>
                                    <div class="p-3 bg-gray-100 rounded-full">
                                        <i class="bi bi-patch-question-fill text-2xl md:text-3xl text-rich_black-700"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-10">
                            <h2 class="text-2xl font-bold text-midnight_green mb-4">فوری رسائی</h2>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                                <button class="add-new-btn bg-white p-4 rounded-xl shadow-lg text-center hover:bg-midnight_green hover:text-white transition-all duration-300 group" data-target="add-fatwa">
                                    <i class="bi bi-journal-plus text-4xl text-midnight_green group-hover:text-white"></i>
                                    <p class="mt-2 text-lg font-bold">نیا فتویٰ</p>
                                </button>
                                 <button class="add-new-btn bg-white p-4 rounded-xl shadow-lg text-center hover:bg-midnight_green hover:text-white transition-all duration-300 group" data-target="add-article">
                                    <i class="bi bi-pencil-square text-4xl text-midnight_green group-hover:text-white"></i>
                                    <p class="mt-2 text-lg font-bold">نیا مضمون</p>
                                </button>
                                 <button class="add-new-btn bg-white p-4 rounded-xl shadow-lg text-center hover:bg-midnight_green hover:text-white transition-all duration-300 group" data-target="add-book">
                                    <i class="bi bi-book-half text-4xl text-midnight_green group-hover:text-white"></i>
                                    <p class="mt-2 text-lg font-bold">نئی کتاب</p>
                                </button>
                                 <button class="add-new-btn bg-white p-4 rounded-xl shadow-lg text-center hover:bg-midnight_green hover:text-white transition-all duration-300 group" data-target="add-ulema">
                                    <i class="bi bi-person-plus-fill text-4xl text-midnight_green group-hover:text-white"></i>
                                    <p class="mt-2 text-lg font-bold">نئے عالم</p>
                                </button>
                                 <button class="add-new-btn bg-white p-4 rounded-xl shadow-lg text-center hover:bg-midnight_green hover:text-white transition-all duration-300 group" data-target="add-category">
                                    <i class="bi bi-grid text-4xl text-midnight_green group-hover:text-white"></i>
                                    <p class="mt-2 text-lg font-bold">نیا موضوع</p>
                                </button>
                                 <a href="#manage-questions" class="admin-nav-link bg-white p-4 rounded-xl shadow-lg text-center hover:bg-midnight_green hover:text-white transition-all duration-300 group">
                                    <i class="bi bi-patch-question-fill text-4xl text-midnight_green group-hover:text-white"></i>
                                    <p class="mt-2 text-lg font-bold">سوالات دیکھیں</p>
                                </a>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg mt-8">
                            <h2 class="text-2xl font-bold text-midnight_green mb-4">حالیہ سرگرمیاں</h2>
                            <div id="recent-activities" class="space-y-2 text-lg">
                                <!-- Activities will be dynamically inserted here -->
                            </div>
                        </div>
                    </div>

                    <!-- Manage Fatawa Page -->
                    <div id="page-manage-fatawa" class="admin-page">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                            <h1 class="text-3xl md:text-4xl font-bold text-midnight_green">فتاویٰ کا انتظام</h1>
                            <button class="add-new-btn bg-midnight_green text-white py-3 px-6 rounded-lg text-lg hover:bg-midnight_green-400 transition w-full md:w-auto" data-target="add-fatwa">نیا فتویٰ شامل کریں</button>
                        </div>
                        <div class="bg-white p-2 md:p-6 rounded-xl shadow-lg">
                            <table class="w-full text-right text-lg responsive-table">
                                <thead>
                                    <tr>
                                        <th class="py-3 px-4">نمبر</th>
                                        <th class="py-3 px-4">عنوان</th>
                                        <th class="py-3 px-4">مفتی صاحب</th>
                                        <th class="py-3 px-4">تاریخ</th>
                                        <th class="py-3 px-4">اعمال</th>
                                    </tr>
                                </thead>
                                <tbody id="fatawa-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Add/Edit Fatwa Page -->
                    <div id="page-add-fatwa" class="admin-page">
                         <h1 id="fatwa-form-title" class="text-3xl md:text-4xl font-bold text-midnight_green mb-8">نیا فتویٰ شامل کریں</h1>
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                            <form id="fatwa-form" class="space-y-6">
                                <input type="hidden" id="fatwa-id">
                                <div>
                                    <label for="fatwa-title" class="block text-xl font-bold text-midnight_green mb-2">عنوان</label>
                                    <input type="text" id="fatwa-title" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="fatwa-slug" class="block text-xl font-bold text-midnight_green mb-2">URL سلگ</label>
                                        <input type="text" id="fatwa-slug" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg font-sans" style="direction: ltr;" placeholder="auto-generated-slug">
                                    </div>
                                    <div>
                                        <label for="fatwa-keywords" class="block text-xl font-bold text-midnight_green mb-2">کلیدی الفاظ (Tags)</label>
                                        <input type="text" id="fatwa-keywords" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" placeholder="حیات النبی, عقیدہ, اہلسنت">
                                    </div>
                                </div>
                                <div>
                                    <label for="fatwa-meta-description" class="block text-xl font-bold text-midnight_green mb-2">SEO تفصیل</label>
                                    <textarea id="fatwa-meta-description" rows="3" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" placeholder="فتویٰ کے بارے میں 150-160 حروف کی مختصر تفصیل"></textarea>
                                </div>
                                <div>
                                    <label for="fatwa-question" class="block text-xl font-bold text-midnight_green mb-2">سوال</label>
                                    <textarea id="fatwa-question" rows="4" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required></textarea>
                                </div>
                                <div>
                                    <label for="fatwa-answer" class="block text-xl font-bold text-midnight_green mb-2">الجواب</label>
                                    <textarea id="fatwa-answer" rows="10" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required></textarea>
                                </div>
                                 <div>
                                    <label for="fatwa-mufti" class="block text-xl font-bold text-midnight_green mb-2">مفتی صاحب</label>
                                    <input type="text" id="fatwa-mufti" value="دارالافتاء، رضوی مرکز" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required>
                                </div>
                                <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 md:space-x-reverse pt-4">
                                    <button type="submit" class="w-full md:w-auto bg-midnight_green text-white py-3 px-8 rounded-lg text-lg hover:bg-midnight_green-400 transition">محفوظ کریں</button>
                                    <button type="button" class="w-full md:w-auto cancel-btn bg-ash_gray text-rich_black py-3 px-8 rounded-lg text-lg hover:bg-ash_gray-400 transition" data-target="manage-fatawa">منسوخ کریں</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Manage Articles Page -->
                    <div id="page-manage-articles" class="admin-page">
                         <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                            <h1 class="text-3xl md:text-4xl font-bold text-midnight_green">مضامین کا انتظام</h1>
                            <button class="add-new-btn bg-midnight_green text-white py-3 px-6 rounded-lg text-lg hover:bg-midnight_green-400 transition w-full md:w-auto" data-target="add-article">نیا مضمون شامل کریں</button>
                        </div>
                         <div class="bg-white p-2 md:p-6 rounded-xl shadow-lg">
                            <table class="w-full text-right text-lg responsive-table">
                                <thead>
                                    <tr>
                                        <th class="py-3 px-4">عنوان</th>
                                        <th class="py-3 px-4">مصنف</th>
                                        <th class="py-3 px-4">تاریخ</th>
                                        <th class="py-3 px-4">اعمال</th>
                                    </tr>
                                </thead>
                                <tbody id="articles-table-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Add/Edit Article Page -->
                    <div id="page-add-article" class="admin-page">
                        <h1 id="article-form-title" class="text-3xl md:text-4xl font-bold text-midnight_green mb-8">نیا مضمون شامل کریں</h1>
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                            <form id="article-form" class="space-y-6">
                                <input type="hidden" id="article-id">
                                <div>
                                    <label for="article-title" class="block text-xl font-bold text-midnight_green mb-2">عنوان</label>
                                    <input type="text" id="article-title" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required>
                                </div>
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="article-slug" class="block text-xl font-bold text-midnight_green mb-2">URL سلگ</label>
                                        <input type="text" id="article-slug" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg font-sans" style="direction: ltr;" placeholder="auto-generated-slug">
                                    </div>
                                    <div>
                                        <label for="article-keywords" class="block text-xl font-bold text-midnight_green mb-2">کلیدی الفاظ (Tags)</label>
                                        <input type="text" id="article-keywords" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" placeholder="ختم نبوت, قادیانیت">
                                    </div>
                                </div>
                                <div>
                                    <label for="article-meta-description" class="block text-xl font-bold text-midnight_green mb-2">SEO تفصیل</label>
                                    <textarea id="article-meta-description" rows="3" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" placeholder="مضمون کے بارے میں 150-160 حروف کی مختصر تفصیل"></textarea>
                                </div>
                                <div>
                                    <label for="article-author" class="block text-xl font-bold text-midnight_green mb-2">مصنف</label>
                                    <input type="text" id="article-author" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required>
                                </div>
                                <div>
                                    <label for="article-image" class="block text-xl font-bold text-midnight_green mb-2">نمایاں تصویر</label>
                                    <input type="file" id="article-image" class="w-full text-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-beige file:text-midnight_green hover:file:bg-ash_gray">
                                </div>
                                <div>
                                    <label for="article-content" class="block text-xl font-bold text-midnight_green mb-2">مضمون کا متن</label>
                                    <textarea id="article-content" rows="12" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required></textarea>
                                </div>
                                <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 md:space-x-reverse pt-4">
                                    <button type="submit" class="w-full md:w-auto bg-midnight_green text-white py-3 px-8 rounded-lg text-lg hover:bg-midnight_green-400 transition">شائع کریں</button>
                                    <button type="button" class="w-full md:w-auto cancel-btn bg-ash_gray text-rich_black py-3 px-8 rounded-lg text-lg hover:bg-ash_gray-400 transition" data-target="manage-articles">منسوخ کریں</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Manage Books Page -->
                    <div id="page-manage-books" class="admin-page">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                            <h1 class="text-3xl md:text-4xl font-bold text-midnight_green">کتابوں کا انتظام</h1>
                            <button class="add-new-btn bg-midnight_green text-white py-3 px-6 rounded-lg text-lg hover:bg-midnight_green-400 transition w-full md:w-auto" data-target="add-book">نئی کتاب شامل کریں</button>
                        </div>
                        <div class="bg-white p-2 md:p-6 rounded-xl shadow-lg">
                            <table class="w-full text-right text-lg responsive-table">
                                <thead>
                                    <tr>
                                        <th class="py-3 px-4">کتاب کا نام</th>
                                        <th class="py-3 px-4">مصنف</th>
                                        <th class="py-3 px-4">اعمال</th>
                                    </tr>
                                </thead>
                                <tbody id="books-table-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Add/Edit Book Page -->
                    <div id="page-add-book" class="admin-page">
                        <h1 id="book-form-title" class="text-3xl md:text-4xl font-bold text-midnight_green mb-8">نئی کتاب شامل کریں</h1>
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                            <form id="book-form" class="space-y-6">
                                <input type="hidden" id="book-id">
                                <div>
                                    <label for="book-name" class="block text-xl font-bold text-midnight_green mb-2">کتاب کا نام</label>
                                    <input type="text" id="book-name" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required>
                                </div>
                                <div>
                                    <label for="book-author" class="block text-xl font-bold text-midnight_green mb-2">مصنف</label>
                                    <input type="text" id="book-author" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required>
                                </div>
                                <div>
                                    <label for="book-cover" class="block text-xl font-bold text-midnight_green mb-2">کتاب کا کور</label>
                                    <input type="file" id="book-cover" class="w-full text-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-beige file:text-midnight_green hover:file:bg-ash_gray">
                                </div>
                                <div>
                                    <label for="book-file" class="block text-xl font-bold text-midnight_green mb-2">PDF فائل</label>
                                    <input type="file" id="book-file" class="w-full text-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-beige file:text-midnight_green hover:file:bg-ash_gray">
                                </div>
                                <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 md:space-x-reverse pt-4">
                                    <button type="submit" class="w-full md:w-auto bg-midnight_green text-white py-3 px-8 rounded-lg text-lg hover:bg-midnight_green-400 transition">شامل کریں</button>
                                    <button type="button" class="w-full md:w-auto cancel-btn bg-ash_gray text-rich_black py-3 px-8 rounded-lg text-lg hover:bg-ash_gray-400 transition" data-target="manage-books">منسوخ کریں</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Manage Ulema Page -->
                    <div id="page-manage-ulema" class="admin-page">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                            <h1 class="text-3xl md:text-4xl font-bold text-midnight_green">علمائے کرام کا انتظام</h1>
                            <button class="add-new-btn bg-midnight_green text-white py-3 px-6 rounded-lg text-lg hover:bg-midnight_green-400 transition w-full md:w-auto" data-target="add-ulema">نئے عالم شامل کریں</button>
                        </div>
                           <div class="bg-white p-2 md:p-6 rounded-xl shadow-lg">
                            <table class="w-full text-right text-lg responsive-table">
                                <thead>
                                    <tr>
                                        <th class="py-3 px-4">نام</th>
                                        <th class="py-3 px-4">عہدہ</th>
                                        <th class="py-3 px-4">اعمال</th>
                                    </tr>
                                </thead>
                                <tbody id="ulema-table-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Add/Edit Ulema Page -->
                    <div id="page-add-ulema" class="admin-page">
                        <h1 id="ulema-form-title" class="text-3xl md:text-4xl font-bold text-midnight_green mb-8">نئے عالم شامل کریں</h1>
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                            <form id="ulema-form" class="space-y-6">
                                <input type="hidden" id="ulema-id">
                                <div>
                                    <label for="ulema-name" class="block text-xl font-bold text-midnight_green mb-2">نام</label>
                                    <input type="text" id="ulema-name" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required>
                                </div>
                                <div>
                                    <label for="ulema-designation" class="block text-xl font-bold text-midnight_green mb-2">عہدہ</label>
                                    <input type="text" id="ulema-designation" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required>
                                </div>
                                <div>
                                    <label for="ulema-photo" class="block text-xl font-bold text-midnight_green mb-2">تصویر</label>
                                    <input type="file" id="ulema-photo" class="w-full text-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-beige file:text-midnight_green hover:file:bg-ash_gray">
                                </div>
                                <div>
                                    <label for="ulema-bio" class="block text-xl font-bold text-midnight_green mb-2">مختصر تعارف</label>
                                    <textarea id="ulema-bio" rows="5" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required></textarea>
                                </div>
                                <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 md:space-x-reverse pt-4">
                                    <button type="submit" class="w-full md:w-auto bg-midnight_green text-white py-3 px-8 rounded-lg text-lg hover:bg-midnight_green-400 transition">شامل کریں</button>
                                    <button type="button" class="w-full md:w-auto cancel-btn bg-ash_gray text-rich_black py-3 px-8 rounded-lg text-lg hover:bg-ash_gray-400 transition" data-target="manage-ulema">منسوخ کریں</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Manage Categories Page -->
                    <div id="page-manage-categories" class="admin-page">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                            <h1 class="text-3xl md:text-4xl font-bold text-midnight_green">موضوعات کا انتظام</h1>
                            <button class="add-new-btn bg-midnight_green text-white py-3 px-6 rounded-lg text-lg hover:bg-midnight_green-400 transition w-full md:w-auto" data-target="add-category">نیا موضوع شامل کریں</button>
                        </div>
                           <div class="bg-white p-2 md:p-6 rounded-xl shadow-lg">
                            <table class="w-full text-right text-lg responsive-table">
                                <thead>
                                    <tr>
                                        <th class="py-3 px-4">موضوع کا نام</th>
                                        <th class="py-3 px-4">آئیکن</th>
                                        <th class="py-3 px-4">اعمال</th>
                                    </tr>
                                </thead>
                                <tbody id="categories-table-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Add/Edit Category Page -->
                    <div id="page-add-category" class="admin-page">
                        <h1 id="category-form-title" class="text-3xl md:text-4xl font-bold text-midnight_green mb-8">نیا موضوع شامل کریں</h1>
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                            <form id="category-form" class="space-y-6">
                                <input type="hidden" id="category-id">
                                <div>
                                    <label for="category-name" class="block text-xl font-bold text-midnight_green mb-2">موضوع کا نام</label>
                                    <input type="text" id="category-name" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required>
                                </div>
                                <div>
                                    <label for="category-icon" class="block text-xl font-bold text-midnight_green mb-2">آئیکن کلاس</label>
                                    <input type="text" id="category-icon" placeholder="مثال: bi bi-gem" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required>
                                    <p class="text-sm text-air_force_blue mt-1">بوٹسٹریپ آئیکنز کی کلاس کا نام درج کریں۔</p>
                                </div>
                                <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 md:space-x-reverse pt-4">
                                    <button type="submit" class="w-full md:w-auto bg-midnight_green text-white py-3 px-8 rounded-lg text-lg hover:bg-midnight_green-400 transition">شامل کریں</button>
                                    <button type="button" class="w-full md:w-auto cancel-btn bg-ash_gray text-rich_black py-3 px-8 rounded-lg text-lg hover:bg-ash_gray-400 transition" data-target="manage-categories">منسوخ کریں</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Manage Questions Page -->
                    <div id="page-manage-questions" class="admin-page">
                        <h1 class="text-3xl md:text-4xl font-bold text-midnight_green mb-8">موصول سوالات</h1>
                           <div class="bg-white p-2 md:p-6 rounded-xl shadow-lg">
                            <table class="w-full text-right text-lg responsive-table">
                                <thead>
                                    <tr>
                                        <th class="py-3 px-4">صارف</th>
                                        <th class="py-3 px-4">سوال کا خلاصہ</th>
                                        <th class="py-3 px-4">کیفیت</th>
                                        <th class="py-3 px-4">اعمال</th>
                                    </tr>
                                </thead>
                                <tbody id="questions-table-body"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Answer Question Page -->
                    <div id="page-answer-question" class="admin-page">
                        <h1 class="text-3xl md:text-4xl font-bold text-midnight_green mb-8">سوال کا جواب دیں</h1>
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                            <div class="mb-6 pb-6 border-b border-ash_gray">
                                <h2 class="text-xl font-bold text-midnight_green">صارف کا سوال:</h2>
                                <p id="question-to-answer-text" class="text-2xl font-semibold my-2 text-rich_black"></p>
                                <p id="question-to-answer-user" class="text-air_force_blue"></p>
                            </div>
                            <form id="answer-form" class="space-y-6">
                                <input type="hidden" id="question-id">
                                <div>
                                    <label for="question-answer" class="block text-xl font-bold text-midnight_green mb-2">الجواب</label>
                                    <textarea id="question-answer" rows="10" class="w-full py-3 px-4 border-2 border-ash_gray rounded-lg focus:outline-none focus:ring-2 focus:ring-midnight_green text-rich_black text-lg" required></textarea>
                                </div>
                                <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 md:space-x-reverse pt-4">
                                    <button type="submit" class="w-full md:w-auto bg-midnight_green text-white py-3 px-8 rounded-lg text-lg hover:bg-midnight_green-400 transition">جواب بھیجیں</button>
                                    <button type="button" class="w-full md:w-auto cancel-btn bg-ash_gray text-rich_black py-3 px-8 rounded-lg text-lg hover:bg-ash_gray-400 transition" data-target="manage-questions">منسوخ کریں</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- Footer -->
                <footer class="text-center py-4 mt-8 text-xs text-gray-400 font-sans">
                    Powered By www.AlQalamArts.com
                </footer>
            </main>
        </div>
    </div>

    <script src="Admin.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DATA STORE ---
            let fatawa = [{ id: 1, title: 'کیا نبی کریم ﷺ اپنی قبر انور میں حیات ہیں؟', slug: 'hayat-un-nabi-sallallahu-alaihi-wasallam', keywords: 'حیات النبی, عقیدہ, اہلسنت', metaDescription: 'اہلسنت والجماعت کا یہ متفقہ عقیدہ ہے کہ انبیاء کرام علیہم السلام اپنی قبروں میں اسی طرح حیات ہیں جیسے دنیا میں تھے۔ اس فتوی میں تفصیلی دلائل موجود ہیں۔', question: 'کیا نبی کریم ﷺ اپنی قبر انور میں حیات ہیں اور سلام سنتے ہیں؟', answer: 'اہلسنت والجماعت کا یہ متفقہ عقیدہ ہے کہ انبیاء کرام علیہم السلام اپنی قبروں میں اسی طرح حیات ہیں جیسے دنیا میں تھے۔..', mufti: 'دارالافتاء، رضوی مرکز', date: '2025-07-26' }];
            let articles = [{ id: 1, title: 'عقیدہ ختمِ نبوت اور ہماری ذمہ داریاں', slug: 'aqeeda-khatm-e-nabuwat', keywords: 'ختم نبوت, قادیانیت', metaDescription: 'عقیدہ ختم نبوت اسلام کا بنیادی عقیدہ ہے۔ اس مضمون میں اس کی اہمیت اور ہماری ذمہ داریوں پر روشنی ڈالی گئی ہے۔', author: 'علامہ ارشد القادری', content: 'ختمِ نبوت کا عقیدہ دینِ اسلام کی اساس ہے۔..', date: '2025-06-15' }];
            let books = [{ id: 1, name: 'فتاویٰ رضویہ', author: 'امام احمد رضا خان' }];
            let ulema = [{ id: 1, name: 'تاج الشریعہ مفتی اختر رضا خان', designation: 'قاضی القضاۃ فی الہند', bio: 'آپ امام احمد رضا خان کے پڑپوتے اور جانشین تھے۔' }];
            let categories = [{ id: 1, name: 'عقائد', icon: 'bi bi-gem' }];
            let questions = [{ id: 1, user: 'احمد رضا', question: 'روزے کی حالت میں انجیکشن لگوانے سے کیا روزہ ٹوٹ جاتا ہے؟', status: 'pending', answer: '' }];
            let activities = [];

            // --- DOM Elements ---
            const mainContent = document.getElementById('admin-main-content');
            const recentActivitiesContainer = document.getElementById('recent-activities');
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebarOverlay = document.getElementById('sidebar-overlay');

            // --- UTILITY FUNCTIONS ---
            const getPageIdFromHash = () => window.location.hash.substring(1) || 'dashboard';
            const createSlug = (text) => text.toString().toLowerCase()
                .replace(/\s+/g, '-')           // Replace spaces with -
                .replace(/[^\u0600-\u06FF\w\-]+/g, '') // Remove all non-word chars except Urdu
                .replace(/\-\-+/g, '-')         // Replace multiple - with single -
                .replace(/^-+/, '')             // Trim - from start of text
                .replace(/-+$/, '');            // Trim - from end of text

            function addActivity(icon, text, type, id) {
                const timestamp = new Date();
                activities.unshift({ icon, text, type, id, timestamp });
                if (activities.length > 6) activities.pop();
                renderActivities();
            }
            
            // --- RESPONSIVE SIDEBAR ---
            function toggleSidebar() {
                // For RTL, we toggle translate-x-full to bring it into view (translate-x-0)
                sidebar.classList.toggle('translate-x-full');
                sidebarOverlay.classList.toggle('hidden');
            }

            sidebarToggle.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);

            // --- RENDER FUNCTIONS ---
            function renderDashboardStats() {
                document.getElementById('total-fatawa').textContent = fatawa.length;
                document.getElementById('total-articles').textContent = articles.length;
                document.getElementById('total-books').textContent = books.length;
                document.getElementById('total-categories').textContent = categories.length;
                document.getElementById('total-questions').textContent = questions.filter(q => q.status === 'pending').length;
            }

            function renderActivities() {
                if (!window.moment) return; // Guard against moment not being loaded
                recentActivitiesContainer.innerHTML = activities.map(act => {
                    let href = '#';
                    if (act.type) {
                        switch(act.type) {
                            case 'fatwa': href = '#add-fatwa'; break;
                            case 'article': href = '#add-article'; break;
                            case 'book': href = '#add-book'; break;
                            case 'ulema': href = '#add-ulema'; break;
                            case 'category': href = '#add-category'; break;
                            case 'question': href = '#answer-question'; break;
                            default: href = `#manage-${act.type}s`;
                        }
                    }
                    
                    const timeAgo = moment(act.timestamp).locale('ur').fromNow();
                    const postDate = new Date(act.timestamp).toLocaleDateString('ur-PK', { day: 'numeric', month: 'short' });

                    return `
                    <a href="${href}" class="activity-link block p-2 rounded-md hover:bg-gray-100 transition" data-id="${act.id}" data-type="${act.type}">
                        <div class="flex items-center">
                            <div class="p-2 ${act.icon.bgColor} rounded-full ml-4"><i class="${act.icon.class} ${act.icon.textColor}"></i></div>
                            <div class="flex-grow">
                                <span>${act.text}</span>
                                <div class="text-air_force_blue text-sm font-sans">${postDate} - ${timeAgo}</div>
                            </div>
                        </div>
                    </a>`;
                }).join('');
            }

            function renderFatawa() {
                const tbody = document.getElementById('fatawa-table-body');
                tbody.innerHTML = fatawa.map((item, index) => `
                    <tr class="border-b border-ash_gray hover:bg-beige-700">
                        <td data-label="نمبر" class="py-3 px-4">${index + 1}</td>
                        <td data-label="عنوان" class="py-3 px-4">${item.title}</td>
                        <td data-label="مفتی صاحب" class="py-3 px-4">${item.mufti}</td>
                        <td data-label="تاریخ" class="py-3 px-4 font-sans">${item.date}</td>
                        <td data-label="اعمال" class="py-3 px-4 space-x-2 space-x-reverse">
                            <button class="edit-btn text-blue-600 hover:text-blue-800" data-id="${item.id}" data-type="fatwa"><i class="bi bi-pencil-fill"></i></button>
                            <button class="delete-btn text-red-600 hover:text-red-800" data-id="${item.id}" data-type="fatwa"><i class="bi bi-trash-fill"></i></button>
                        </td>
                    </tr>
                `).join('');
            }

            function renderArticles() {
                const tbody = document.getElementById('articles-table-body');
                tbody.innerHTML = articles.map(item => `
                    <tr class="border-b border-ash_gray hover:bg-beige-700">
                        <td data-label="عنوان" class="py-3 px-4">${item.title}</td>
                        <td data-label="مصنف" class="py-3 px-4">${item.author}</td>
                        <td data-label="تاریخ" class="py-3 px-4 font-sans">${item.date}</td>
                        <td data-label="اعمال" class="py-3 px-4 space-x-2 space-x-reverse">
                            <button class="edit-btn text-blue-600 hover:text-blue-800" data-id="${item.id}" data-type="article"><i class="bi bi-pencil-fill"></i></button>
                            <button class="delete-btn text-red-600 hover:text-red-800" data-id="${item.id}" data-type="article"><i class="bi bi-trash-fill"></i></button>
                        </td>
                    </tr>
                `).join('');
            }
            
            function renderBooks() {
                const tbody = document.getElementById('books-table-body');
                tbody.innerHTML = books.map(item => `
                    <tr class="border-b border-ash_gray hover:bg-beige-700">
                        <td data-label="کتاب کا نام" class="py-3 px-4">${item.name}</td>
                        <td data-label="مصنف" class="py-3 px-4">${item.author}</td>
                        <td data-label="اعمال" class="py-3 px-4 space-x-2 space-x-reverse">
                            <button class="edit-btn text-blue-600 hover:text-blue-800" data-id="${item.id}" data-type="book"><i class="bi bi-pencil-fill"></i></button>
                            <button class="delete-btn text-red-600 hover:text-red-800" data-id="${item.id}" data-type="book"><i class="bi bi-trash-fill"></i></button>
                        </td>
                    </tr>
                `).join('');
            }

            function renderUlema() {
                const tbody = document.getElementById('ulema-table-body');
                tbody.innerHTML = ulema.map(item => `
                    <tr class="border-b border-ash_gray hover:bg-beige-700">
                        <td data-label="نام" class="py-3 px-4">${item.name}</td>
                        <td data-label="عہدہ" class="py-3 px-4">${item.designation}</td>
                        <td data-label="اعمال" class="py-3 px-4 space-x-2 space-x-reverse">
                            <button class="edit-btn text-blue-600 hover:text-blue-800" data-id="${item.id}" data-type="ulema"><i class="bi bi-pencil-fill"></i></button>
                            <button class="delete-btn text-red-600 hover:text-red-800" data-id="${item.id}" data-type="ulema"><i class="bi bi-trash-fill"></i></button>
                        </td>
                    </tr>
                `).join('');
            }

            function renderCategories() {
                 const tbody = document.getElementById('categories-table-body');
                 tbody.innerHTML = categories.map(item => `
                    <tr class="border-b border-ash_gray hover:bg-beige-700">
                        <td data-label="موضوع کا نام" class="py-3 px-4">${item.name}</td>
                        <td data-label="آئیکن" class="py-3 px-4"><i class="${item.icon} text-2xl"></i></td>
                        <td data-label="اعمال" class="py-3 px-4 space-x-2 space-x-reverse">
                            <button class="edit-btn text-blue-600 hover:text-blue-800" data-id="${item.id}" data-type="category"><i class="bi bi-pencil-fill"></i></button>
                            <button class="delete-btn text-red-600 hover:text-red-800" data-id="${item.id}" data-type="category"><i class="bi bi-trash-fill"></i></button>
                        </td>
                    </tr>
                `).join('');
            }
            
            function renderQuestions() {
                const tbody = document.getElementById('questions-table-body');
                tbody.innerHTML = questions.map(item => `
                    <tr class="border-b border-ash_gray hover:bg-beige-700">
                        <td data-label="صارف" class="py-3 px-4">${item.user}</td>
                        <td data-label="سوال کا خلاصہ" class="py-3 px-4">${item.question.substring(0, 30)}...</td>
                        <td data-label="کیفیت" class="py-3 px-4"><span class="${item.status === 'pending' ? 'bg-yellow-200 text-yellow-800' : 'bg-green-200 text-green-800'} py-1 px-3 rounded-full">${item.status === 'pending' ? 'زیرِ غور' : 'جواب دیا گیا'}</span></td>
                        <td data-label="اعمال" class="py-3 px-4 space-x-2 space-x-reverse">
                            ${item.status === 'pending' ? `<button class="answer-btn text-green-600 hover:text-green-800" data-id="${item.id}">جواب دیں</button>` : ''}
                            <button class="delete-btn text-red-600 hover:text-red-800" data-id="${item.id}" data-type="question"><i class="bi bi-trash-fill"></i></button>
                        </td>
                    </tr>
                `).join('');
            }

            // --- PAGE NAVIGATION ---
            function showPage(pageId) {
                document.querySelectorAll('.admin-page').forEach(page => page.classList.remove('active'));
                const targetPage = document.getElementById('page-' + pageId);
                if (targetPage) {
                    targetPage.classList.add('active');
                } else {
                    document.getElementById('page-dashboard').classList.add('active');
                }
                window.scrollTo(0, 0);
                if (window.innerWidth < 768 && !sidebar.classList.contains('translate-x-full')) {
                    toggleSidebar();
                }
            }

            function handleHashChange() {
                const pageId = getPageIdFromHash();
                showPage(pageId);
                document.querySelectorAll('.admin-nav-link').forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href').substring(1).startsWith(pageId.split('-')[0]));
                });
            }

            // --- FORM & EDITING LOGIC ---
            function resetAndGoTo(pageId) {
                document.querySelectorAll('form').forEach(form => form.reset());
                document.querySelectorAll('input[type="hidden"]').forEach(input => input.value = '');
                window.location.hash = pageId;
            }
            
            function triggerEdit(type, id) {
                let targetHash = '';
                switch(type) {
                    case 'fatwa':
                        const fatwaItem = fatawa.find(f => f.id == id);
                        if (!fatwaItem) return;
                        document.getElementById('fatwa-form-title').innerText = 'فتویٰ میں ترمیم کریں';
                        document.getElementById('fatwa-id').value = fatwaItem.id;
                        document.getElementById('fatwa-title').value = fatwaItem.title;
                        document.getElementById('fatwa-slug').value = fatwaItem.slug || '';
                        document.getElementById('fatwa-keywords').value = fatwaItem.keywords || '';
                        document.getElementById('fatwa-meta-description').value = fatwaItem.metaDescription || '';
                        document.getElementById('fatwa-question').value = fatwaItem.question;
                        document.getElementById('fatwa-answer').value = fatwaItem.answer;
                        document.getElementById('fatwa-mufti').value = fatwaItem.mufti;
                        targetHash = 'add-fatwa';
                        break;
                    case 'article':
                        const articleItem = articles.find(a => a.id == id);
                        if (!articleItem) return;
                        document.getElementById('article-form-title').innerText = 'مضمون میں ترمیم کریں';
                        document.getElementById('article-id').value = articleItem.id;
                        document.getElementById('article-title').value = articleItem.title;
                        document.getElementById('article-slug').value = articleItem.slug || '';
                        document.getElementById('article-keywords').value = articleItem.keywords || '';
                        document.getElementById('article-meta-description').value = articleItem.metaDescription || '';
                        document.getElementById('article-author').value = articleItem.author;
                        document.getElementById('article-content').value = articleItem.content;
                        targetHash = 'add-article';
                        break;
                    case 'book':
                        const bookItem = books.find(b => b.id == id);
                        if (!bookItem) return;
                        document.getElementById('book-form-title').innerText = 'کتاب میں ترمیم کریں';
                        document.getElementById('book-id').value = bookItem.id;
                        document.getElementById('book-name').value = bookItem.name;
                        document.getElementById('book-author').value = bookItem.author;
                        targetHash = 'add-book';
                        break;
                    case 'ulema':
                        const ulemaItem = ulema.find(u => u.id == id);
                        if (!ulemaItem) return;
                        document.getElementById('ulema-form-title').innerText = 'عالم کی پروفائل میں ترمیم کریں';
                        document.getElementById('ulema-id').value = ulemaItem.id;
                        document.getElementById('ulema-name').value = ulemaItem.name;
                        document.getElementById('ulema-designation').value = ulemaItem.designation;
                        document.getElementById('ulema-bio').value = ulemaItem.bio;
                        targetHash = 'add-ulema';
                        break;
                    case 'category':
                        const categoryItem = categories.find(c => c.id == id);
                        if (!categoryItem) return;
                        document.getElementById('category-form-title').innerText = 'موضوع میں ترمیم کریں';
                        document.getElementById('category-id').value = categoryItem.id;
                        document.getElementById('category-name').value = categoryItem.name;
                        document.getElementById('category-icon').value = categoryItem.icon;
                        targetHash = 'add-category';
                        break;
                    case 'question':
                        const questionItem = questions.find(q => q.id == id);
                        if (!questionItem) return;
                        document.getElementById('question-id').value = questionItem.id;
                        document.getElementById('question-to-answer-text').innerText = questionItem.question;
                        document.getElementById('question-to-answer-user').innerText = `صارف: ${questionItem.user}`;
                        targetHash = 'answer-question';
                        break;
                }
                if (targetHash) {
                    window.location.hash = targetHash;
                }
            }

            function handleFormSubmit(e) {
                e.preventDefault();
                const form = e.target;
                const pageId = getPageIdFromHash();

                switch(pageId) {
                    case 'add-fatwa': {
                        const fatwaId = document.getElementById('fatwa-id').value;
                        const fatwaData = {
                            title: document.getElementById('fatwa-title').value,
                            slug: document.getElementById('fatwa-slug').value || createSlug(document.getElementById('fatwa-title').value),
                            keywords: document.getElementById('fatwa-keywords').value,
                            metaDescription: document.getElementById('fatwa-meta-description').value,
                            question: document.getElementById('fatwa-question').value,
                            answer: document.getElementById('fatwa-answer').value,
                            mufti: document.getElementById('fatwa-mufti').value,
                            date: new Date().toISOString().slice(0, 10)
                        };

                        if (fatwaId) { // Update
                            const index = fatawa.findIndex(f => f.id == fatwaId);
                            fatawa[index] = { ...fatawa[index], ...fatwaData };
                            addActivity({ class: 'bi bi-pencil', textColor: 'text-yellow-600', bgColor: 'bg-yellow-100' }, `فتویٰ "${fatwaData.title}" کو اپ ڈیٹ کیا گیا۔`, 'fatwa', fatwaId);
                        } else { // Add
                            fatwaData.id = Date.now();
                            fatawa.push(fatwaData);
                             addActivity({ class: 'bi bi-journal-plus', textColor: 'text-green-600', bgColor: 'bg-green-100' }, `ایک نیا فتویٰ "${fatwaData.title}" شامل کیا گیا۔`, 'fatwa', fatwaData.id);
                        }
                        renderFatawa();
                        renderDashboardStats();
                        resetAndGoTo('manage-fatawa');
                        break;
                    }
                    case 'add-article': {
                        const articleId = document.getElementById('article-id').value;
                        const articleData = {
                            title: document.getElementById('article-title').value,
                            slug: document.getElementById('article-slug').value || createSlug(document.getElementById('article-title').value),
                            keywords: document.getElementById('article-keywords').value,
                            metaDescription: document.getElementById('article-meta-description').value,
                            author: document.getElementById('article-author').value,
                            content: document.getElementById('article-content').value,
                            date: new Date().toISOString().slice(0, 10)
                        };

                        if (articleId) { // Update
                            const index = articles.findIndex(a => a.id == articleId);
                            articles[index] = { ...articles[index], ...articleData };
                            addActivity({ class: 'bi bi-pencil', textColor: 'text-yellow-600', bgColor: 'bg-yellow-100' }, `مضمون "${articleData.title}" کو اپ ڈیٹ کیا گیا۔`, 'article', articleId);
                        } else { // Add
                            articleData.id = Date.now();
                            articles.push(articleData);
                            addActivity({ class: 'bi bi-pencil-square', textColor: 'text-green-600', bgColor: 'bg-green-100' }, `نیا مضمون "${articleData.title}" شامل کیا گیا۔`, 'article', articleData.id);
                        }
                        renderArticles();
                        renderDashboardStats();
                        resetAndGoTo('manage-articles');
                        break;
                    }
                    case 'add-book': {
                        const bookId = document.getElementById('book-id').value;
                        const bookData = {
                            name: document.getElementById('book-name').value,
                            author: document.getElementById('book-author').value,
                        };

                        if (bookId) { // Update
                            const index = books.findIndex(b => b.id == bookId);
                            books[index] = { ...books[index], ...bookData };
                            addActivity({ class: 'bi bi-pencil', textColor: 'text-yellow-600', bgColor: 'bg-yellow-100' }, `کتاب "${bookData.name}" کو اپ ڈیٹ کیا گیا۔`, 'book', bookId);
                        } else { // Add
                            bookData.id = Date.now();
                            books.push(bookData);
                            addActivity({ class: 'bi bi-book', textColor: 'text-green-600', bgColor: 'bg-green-100' }, `نئی کتاب "${bookData.name}" شامل کی گئی۔`, 'book', bookData.id);
                        }
                        renderBooks();
                        renderDashboardStats();
                        resetAndGoTo('manage-books');
                        break;
                    }
                    case 'add-ulema': {
                        const ulemaId = document.getElementById('ulema-id').value;
                        const ulemaData = {
                            name: document.getElementById('ulema-name').value,
                            designation: document.getElementById('ulema-designation').value,
                            bio: document.getElementById('ulema-bio').value,
                        };

                        if (ulemaId) { // Update
                            const index = ulema.findIndex(u => u.id == ulemaId);
                            ulema[index] = { ...ulema[index], ...ulemaData };
                            addActivity({ class: 'bi bi-pencil', textColor: 'text-yellow-600', bgColor: 'bg-yellow-100' }, `عالم "${ulemaData.name}" کی پروفائل اپ ڈیٹ کی گئی۔`, 'ulema', ulemaId);
                        } else { // Add
                            ulemaData.id = Date.now();
                            ulema.push(ulemaData);
                            addActivity({ class: 'bi bi-person-plus-fill', textColor: 'text-green-600', bgColor: 'bg-green-100' }, `نئے عالم "${ulemaData.name}" کو شامل کیا گیا۔`, 'ulema', ulemaData.id);
                        }
                        renderUlema();
                        renderDashboardStats();
                        resetAndGoTo('manage-ulema');
                        break;
                    }
                    case 'add-category': {
                        const categoryId = document.getElementById('category-id').value;
                        const categoryData = {
                            name: document.getElementById('category-name').value,
                            icon: document.getElementById('category-icon').value,
                        };

                        if (categoryId) { // Update
                             const index = categories.findIndex(c => c.id == categoryId);
                            categories[index] = { ...categories[index], ...categoryData };
                             addActivity({ class: 'bi bi-pencil', textColor: 'text-yellow-600', bgColor: 'bg-yellow-100' }, `موضوع "${categoryData.name}" کو اپ ڈیٹ کیا گیا۔`, 'category', categoryId);
                        } else { // Add
                            categoryData.id = Date.now();
                            categories.push(categoryData);
                             addActivity({ class: 'bi bi-grid', textColor: 'text-green-600', bgColor: 'bg-green-100' }, `نیا موضوع "${categoryData.name}" شامل کیا گیا۔`, 'category', categoryData.id);
                        }
                        renderCategories();
                        renderDashboardStats();
                        resetAndGoTo('manage-categories');
                        break;
                    }
                    case 'answer-question': {
                        const questionId = document.getElementById('question-id').value;
                        const answer = document.getElementById('question-answer').value;
                        const questionIndex = questions.findIndex(q => q.id == questionId);
                        if(questionIndex !== -1) {
                            questions[questionIndex].answer = answer;
                            questions[questionIndex].status = 'answered';
                            addActivity({ class: 'bi bi-check-circle-fill', textColor: 'text-green-600', bgColor: 'bg-green-100' }, `صارف "${questions[questionIndex].user}" کے سوال کا جواب دیا گیا۔`, 'question', questionId);
                        }
                        renderQuestions();
                        renderDashboardStats();
                        resetAndGoTo('manage-questions');
                        break;
                    }
                }
            }

            // --- EVENT LISTENERS ---
            mainContent.addEventListener('click', function(e) {
                const target = e.target;
                if (target.closest('.edit-btn')) {
                    const btn = target.closest('.edit-btn');
                    triggerEdit(btn.dataset.type, btn.dataset.id);
                }

                if (target.closest('.delete-btn')) {
                    const btn = target.closest('.delete-btn');
                    if (confirm('کیا آپ واقعی اسے حذف کرنا چاہتے ہیں؟')) {
                        const id = btn.dataset.id;
                        const type = btn.dataset.type;
                        switch(type) {
                            case 'fatwa': fatawa = fatawa.filter(f => f.id != id); renderFatawa(); break;
                            case 'article': articles = articles.filter(a => a.id != id); renderArticles(); break;
                            case 'book': books = books.filter(b => b.id != id); renderBooks(); break;
                            case 'ulema': ulema = ulema.filter(u => u.id != id); renderUlema(); break;
                            case 'category': categories = categories.filter(c => c.id != id); renderCategories(); break;
                            case 'question': questions = questions.filter(q => q.id != id); renderQuestions(); break;
                        }
                        renderDashboardStats();
                        addActivity({ class: 'bi bi-trash-fill', textColor: 'text-red-600', bgColor: 'bg-red-100' }, `ایک آئٹم حذف کر دیا گیا۔`, null, null);
                    }
                }
                
                if (target.closest('.answer-btn')) {
                    const btn = target.closest('.answer-btn');
                    triggerEdit('question', btn.dataset.id);
                }

                if (target.closest('.add-new-btn')) {
                    const btnTarget = target.closest('.add-new-btn').dataset.target;
                    if(btnTarget === 'add-fatwa') document.getElementById('fatwa-form-title').innerText = 'نیا فتویٰ شامل کریں';
                    if(btnTarget === 'add-article') document.getElementById('article-form-title').innerText = 'نیا مضمون شامل کریں';
                    if(btnTarget === 'add-book') document.getElementById('book-form-title').innerText = 'نئی کتاب شامل کریں';
                    if(btnTarget === 'add-ulema') document.getElementById('ulema-form-title').innerText = 'نئے عالم شامل کریں';
                    if(btnTarget === 'add-category') document.getElementById('category-form-title').innerText = 'نیا موضوع شامل کریں';
                    resetAndGoTo(btnTarget);
                }
                
                if (target.closest('.cancel-btn')) {
                    const btnTarget = target.closest('.cancel-btn').dataset.target;
                    resetAndGoTo(btnTarget);
                }
            });
            
            mainContent.addEventListener('input', e => {
                if (e.target.id === 'fatwa-title') {
                    document.getElementById('fatwa-slug').value = createSlug(e.target.value);
                } else if (e.target.id === 'article-title') {
                    document.getElementById('article-slug').value = createSlug(e.target.value);
                }
            });

            recentActivitiesContainer.addEventListener('click', function(e) {
                const link = e.target.closest('.activity-link');
                if (link) {
                    e.preventDefault();
                    const id = link.dataset.id;
                    const type = link.dataset.type;
                    if (id && type && type !== 'null') {
                         triggerEdit(type, id);
                    }
                }
            });

            mainContent.addEventListener('submit', handleFormSubmit);

            // --- INITIALIZATION ---
            function initApp() {
                moment.locale('ur');

                addActivity({ class: 'bi bi-person-plus-fill', textColor: 'text-green-600', bgColor: 'bg-green-100' }, `نئے عالم "تاج الشریعہ مفتی اختر رضا خان" کو شامل کیا گیا۔`, 'ulema', 1);
                addActivity({ class: 'bi bi-grid', textColor: 'text-green-600', bgColor: 'bg-green-100' }, `نیا موضوع "عقائد" شامل کیا گیا۔`, 'category', 1);
                addActivity({ class: 'bi bi-book', textColor: 'text-green-600', bgColor: 'bg-green-100' }, `نئی کتاب "فتاویٰ رضویہ" شامل کی گئی۔`, 'book', 1);
                addActivity({ class: 'bi bi-pencil', textColor: 'text-yellow-600', bgColor: 'bg-yellow-100' }, `مضمون "عقیدہ ختمِ نبوت اور ہماری ذمہ داریاں" کو اپ ڈیٹ کیا گیا۔`, 'article', 1);
                addActivity({ class: 'bi bi-patch-question-fill', textColor: 'text-blue-600', bgColor: 'bg-blue-100' }, 'صارف "احمد رضا" کی جانب سے ایک سوال موصول ہوا۔', 'question', 1);
                addActivity({ class: 'bi bi-journal-plus', textColor: 'text-green-600', bgColor: 'bg-green-100' }, `ایک نیا فتویٰ "حیات النبی ﷺ" شامل کیا گیا۔`, 'fatwa', 1);

                window.addEventListener('hashchange', handleHashChange);
                handleHashChange();

                renderDashboardStats();
                renderFatawa();
                renderArticles();
                renderBooks();
                renderUlema();
                renderCategories();
                renderQuestions();
            }

            function loadScriptsAndInit() {
                const momentScript = document.createElement('script');
                momentScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js';
                momentScript.onload = () => {
                    const momentUrdu = document.createElement('script');
                    momentUrdu.src = 'https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/locale/ur.min.js';
                    momentUrdu.onload = initApp;
                    document.head.appendChild(momentUrdu);
                };
                momentScript.onerror = () => {
                    console.error("Failed to load moment.js. Some features might not work.");
                    // Fallback or error display logic here
                };
                document.head.appendChild(momentScript);
            }

            loadScriptsAndInit();
        });
    </script>

</body>
</html>
