<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>فتوی تفصیل - مسائل ورلڈ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <style>
        @font-face {
            font-family: 'NaatFont';
            src: url('https://res.cloudinary.com/awescreative/raw/upload/v1749150996/Awes/naatfont.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        body {
            font-family: 'NaatFont', serif;
            font-size: 80%;
            direction: rtl;
            text-align: right;
        }
        .hero-section {
            background-image:
              linear-gradient(rgba(1, 22, 30, 0.7), rgba(1, 22, 30, 0.7)),
              url('https://img.freepik.com/free-photo/close-up-islamic-new-year-concept-with-misbaha_23-2148611691.jpg');
            background-size: cover;
            background-position: center;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        /* Specific styles for answer section */
        .ms-fatwa-answer {
            direction: rtl;
            text-align: justify; /* Justify the paragraphs for neat look */
            line-height: 1.7;
        }
        /* For any English text within Urdu, let browser handle natural LTR */
        .ms-fatwa-answer p {
            unicode-bidi: embed;
        }
    </style>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              rich_black: {
                DEFAULT: '#01161e',
                100: '#000406',
                200: '#00090c',
                300: '#010d12',
                400: '#011118',
                500: '#01161e',
                600: '#04597b',
                700: '#079cd8',
                800: '#45c6f9',
                900: '#a2e3fc',
              },
              midnight_green: {
                DEFAULT: '#124559',
                100: '#040e12',
                200: '#071c24',
                300: '#0b2935',
                400: '#0f3747',
                500: '#124559',
                600: '#20799c',
                700: '#36a9d6',
                800: '#79c5e4',
                900: '#bce2f1',
              },
              air_force_blue: {
                DEFAULT: '#598392',
                100: '#121a1d',
                200: '#24343a',
                300: '#354e57',
                400: '#476874',
                500: '#598392',
                600: '#769dab',
                700: '#99b6c0',
                800: '#bbced5',
                900: '#dde7ea',
              },
              ash_gray: {
                DEFAULT: '#aec3b0',
                100: '#1f2a20',
                200: '#3e5441',
                300: '#5e7f61',
                400: '#83a386',
                500: '#aec3b0',
                600: '#bdcebf',
                700: '#cedbcf',
                800: '#dee7df',
                900: '#eff3ef',
              },
              beige: {
                DEFAULT: '#eff6e0',
                100: '#384915',
                200: '#71912a',
                300: '#a4cc4e',
                400: '#c9e197',
                500: '#eff6e0',
                600: '#f2f8e6',
                700: '#f5f9ec',
                800: '#f8fbf2',
                900: '#fcfdf9',
              },
            },
          },
        },
      };
    </script>
</head>
<body class="bg-beige-600 text-rich_black">

    <!-- Header (Same as your original) -->
    <header id="qs-header" class="as-header bg-beige/80 backdrop-blur-sm shadow-sm sticky top-0 z-50">
        <nav class="ms-nav container mx-auto px-6 py-4">
            <div class="flex justify-between items-center" style="direction:ltr">
                <div class="text-3xl font-bold text-midnight_green">
                    <a href="#home" class="nav-link ms-logo" style="direction:rtl">مسائل ورلڈ</a>
                </div>
                <div class="hidden md:flex items-center space-x-reverse space-x-8 ms-desktop-menu" style="direction:rtl;">
                    <a href="#home" class="nav-link ms-nav-link text-midnight_green hover:text-midnight_green-600 transition text-lg">صفحہ اول</a>
                    <a href="#fatawa" class="nav-link ms-nav-link text-midnight_green hover:text-midnight_green-600 transition text-lg">فتاویٰ</a>
                    <a href="#articles" class="nav-link ms-nav-link text-midnight_green hover:text-midnight_green-600 transition text-lg">مضامین</a>
                    <a href="#books" class="nav-link ms-nav-link text-midnight_green hover:text-midnight_green-600 transition text-lg">کتابیں</a>
                    <a href="#about" class="nav-link ms-nav-link text-midnight_green hover:text-midnight_green-600 transition text-lg">ہمارے بارے میں</a>
                </div>
                <div class="flex items-center" style="direction:ltr">
                     <a href="#ask" class="nav-link ms-button hidden sm:block bg-midnight_green text-white py-2 px-5 rounded-full hover:bg-midnight_green-400 transition text-lg">سوال پوچھیں</a>
                    <div class="md:hidden ml-4">
                        <button id="mobile-menu-button" class="ms-mobile-btn text-midnight_green focus:outline-none">
                            <i class="bi bi-list text-4xl"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div id="mobile-menu" class="hidden md:hidden mt-4 bg-beige rounded-md shadow-lg ms-mobile-menu" style="direction:rtl;">
                <a href="#home" class="nav-link ms-nav-link block py-3 px-4 text-lg text-midnight_green hover:bg-ash_gray rounded-t-md">صفحہ اول</a>
                <a href="#fatawa" class="nav-link ms-nav-link block py-3 px-4 text-lg text-midnight_green hover:bg-ash_gray">فتاویٰ</a>
                <a href="#articles" class="nav-link ms-nav-link block py-3 px-4 text-lg text-midnight_green hover:bg-ash_gray">مضامین</a>
                <a href="#books" class="nav-link ms-nav-link block py-3 px-4 text-lg text-midnight_green hover:bg-ash_gray">کتابیں</a>
                <a href="#about" class="nav-link ms-nav-link block py-3 px-4 text-lg text-midnight_green hover:bg-ash_gray">ہمارے بارے میں</a>
                <a href="#ask" class="nav-link ms-button block mt-4 text-center bg-midnight_green text-white py-3 px-4 rounded-full hover:bg-midnight_green-400 transition text-lg">سوال پوچھیں</a>
            </div>
        </nav>
    </header>

    <!-- Page Content -->
    <div id="page-fatwa-detail" class="page active">
        <main class="py-20 bg-beige-600">
            <div class="container mx-auto px-6 max-w-5xl">
                <a href="#fatawa" class="nav-link text-midnight_green hover:text-midnight_green-600 font-bold text-lg mb-8 inline-block">&rarr; واپس تمام فتاویٰ پر</a>

                <!-- Fatawa Detail -->
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <div class="pb-6">
                        <h2 class="ms-fatwa-question-label text-xl font-bold text-midnight_green">سوال:</h2>
                        <p
                          class="ms-fatwa-question text-4xl font-semibold my-2 text-rich_black leading-normal"
                        ></p>
                    </div>
                    <div class="py-6 border-t border-ash_gray">
                        <h2 class="ms-fatwa-answer-label text-xl font-bold text-midnight_green">الجواب حامداً ومصلیاً:</h2>
                        <div
                          class="ms-fatwa-answer text-rich_black-600 text-xl mt-4 space-y-4 leading-relaxed"
                        ></div>
                    </div>
                    <div class="pt-6 border-t border-ash_gray flex items-center justify-between">
                        <div>
                            <p class="font-bold text-midnight_green"></p>
                            <p class="text-air_force_blue"></p>
                        </div>
                        <div
                          class="flex items-center space-x-6 space-x-reverse text-air_force_blue text-lg"
                        >
                            <div class="flex items-center">
                                <i class="bi bi-eye-fill ml-2"></i><span class="font-sans">0</span>
                            </div>
                            <div class="flex items-center">
                                <i class="bi bi-hand-thumbs-up-fill ml-2"></i><span class="font-sans">0</span>
                            </div>
                            <a href="#" class="flex items-center hover:text-midnight_green"
                              ><i class="bi bi-share-fill ml-2"></i
                            ></a>
                        </div>
                    </div>
                </div>

                <!-- Related Fatawa -->
                <div class="mt-16">
                    <h2 class="ms-section-title text-4xl font-bold text-center text-midnight_green mb-12">
                      متعلقہ فتاویٰ
                    </h2>
                    <div
                      id="related-fatwas"
                      class="grid grid-cols-1 md:grid-cols-2 gap-6"
                    ></div>
                </div>
            </div>
        </main>
    </div>

<script>
/**
 * Helper: gets query param from current URL
 */
function getQueryParam(name) {
    const url = new URL(window.location.href);
    return url.searchParams.get(name);
}

/**
 * Helper: safe text content update
 */
function setText(selector, text) {
    const el = document.querySelector(selector);
    if (el) el.textContent = text || '';
}

/**
 * Fetch + Render Fatwa Detail
 */
async function loadFatwaDetailById(id) {
    let fatwa = null;
    try {
        const res = await fetch(`https://masailworld.onrender.com/api/article/${id}`);
        if (!res.ok) throw new Error('Not found via detail API');
        fatwa = await res.json();
    } catch {
        // Fallback: fetch list and find fatwa in paged results
        const res = await fetch('https://masailworld.onrender.com/api/article/paged?page=1&limit=100');
        const fatawa = await res.json();
        fatwa = (Array.isArray(fatawa) ? fatawa.find(f => String(f.ArticleID || f.ID || f.id || f._id) === String(id)) : null);
    }
    if (!fatwa) {
        alert("یہ فتویٰ دستیاب نہیں ہے۔");
        return;
    }

    // Set question/title
    setText('.ms-fatwa-question', fatwa.Title);
    // Set answer/body (contains HTML)
    const answerDiv = document.querySelector('.ms-fatwa-answer');
    if (answerDiv) {
        // Insert HTML safely (assumes trusted API)
        answerDiv.innerHTML = fatwa.ArticleDescription || fatwa.Description || '<p>جواب دستیاب نہیں۔</p>';
    }
    // Author & Location
    setText('.font-bold.text-midnight_green', fatwa.Author || 'دارالافتاء، رضوی مرکز');
    setText('.text-air_force_blue', fatwa.Location || 'بریلی شریف، ہندوستان');
    // Views & Likes
    const viewsSpan = document.querySelector('.bi-eye-fill + span');
    if (viewsSpan) viewsSpan.textContent = fatwa.VIEW || '0';
    const likesSpan = document.querySelector('.bi-hand-thumbs-up-fill + span');
    if (likesSpan) likesSpan.textContent = fatwa.likes || '0';
    // Share link
    const shareLink = document.querySelector('a .bi-share-fill')?.parentElement;
    if (shareLink) shareLink.href = window.location.href;
}

/**
 * Fetch + Render Related Fatawa (maximum 4 excluding current)
 */
async function loadRelatedFatawa(currentFatwaId) {
    try {
        const res = await fetch('https://masailworld.onrender.com/api/article/paged?page=1&limit=50');
        if (!res.ok) throw new Error('Network error');
        const fatawaList = await res.json();

        const relatedContainer = document.getElementById('related-fatwas');
        if (!relatedContainer) return;

        const relatedFatawa = fatawaList.filter(f => String(f.ArticleID || f.ID || f.id || f._id) !== String(currentFatwaId)).slice(0, 4);
        relatedContainer.innerHTML = '';
        if (!relatedFatawa.length) {
            relatedContainer.innerHTML = "<div class='col-span-2 text-center text-gray-700'>متعلقہ فتاویٰ دستیاب نہیں۔</div>";
            return;
        }

        function stripHtml(html) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            return tempDiv.textContent || tempDiv.innerText || '';
        }

        relatedFatawa.forEach(fatwa => {
            const fid = fatwa.ArticleID || fatwa.ID || fatwa.id || fatwa._id;
            const a = document.createElement('a');
            a.href = "javascript:void(0)";
            a.className = 'ms-card-related block bg-white p-6 rounded-lg hover:shadow-lg border border-ash_gray hover:border-midnight_green-200 transition cursor-pointer';
            a.style.direction = 'rtl';

            const h3 = document.createElement('h3');
            h3.className = 'ms-card-title text-2xl font-semibold text-rich_black';
            h3.textContent = fatwa.Title || 'عنوان دستیاب نہیں';

            const p = document.createElement('p');
            p.className = 'ms-card-text text-rich_black-600 text-base mt-2 leading-relaxed';
            let desc = stripHtml(fatwa.ArticleDescription || fatwa.Description || '');
            if (desc.length > 120) desc = desc.substring(0, 117) + '...';
            p.textContent = desc;

            a.appendChild(h3);
            a.appendChild(p);

            a.onclick = () => {
                window.history.pushState(null, '', `?id=${fid}`);
                loadFatwaDetailById(fid);
                loadRelatedFatawa(fid);
                document.getElementById('page-fatwa-detail').scrollIntoView({ behavior: 'smooth' });
            };

            relatedContainer.appendChild(a);
        });
    } catch (err) {
        const relatedContainer = document.getElementById('related-fatwas');
        if (relatedContainer)
            relatedContainer.innerHTML = "<div class='col-span-2 text-center text-gray-700'>متعلقہ فتاویٰ لوڈ نہیں ہو سکے۔</div>";
        console.error(err);
    }
}

/**
 * Initial page load
 */
document.addEventListener('DOMContentLoaded', () => {
    let fatwaId = getQueryParam('id');
    if (!fatwaId) {
        alert('فتویٰ کی شناخت دستیاب نہیں!');
        return;
    }
    loadFatwaDetailById(fatwaId);
    loadRelatedFatawa(fatwaId);

    // Handle back/forward navigation
    window.addEventListener('popstate', () => {
        fatwaId = getQueryParam('id');
        if (fatwaId) {
            loadFatwaDetailById(fatwaId);
            loadRelatedFatawa(fatwaId);
        }
    });
});
</script>

</body>
</html>
